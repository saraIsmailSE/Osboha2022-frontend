"use strict";(self["webpackChunkOsboha180"]=self["webpackChunkOsboha180"]||[]).push([[9002],{28143:function(e,s,t){t.d(s,{Z:function(){return oe}});var i=t(66252),o=t(49963),r=t(3577);const h=e=>((0,i.dD)("data-v-a0683062"),e=e(),(0,i.Cn)(),e),a={class:"d-flex align-items-center w-100 row"},l={class:"row"},d=h((()=>(0,i._)("div",{class:"form-group"},[(0,i._)("h5",{class:"form-label"},"نوع الأطروحة")],-1))),n={class:"form-group"},c=(0,i.uE)('<option value="" data-v-a0683062>اختر نوع الأطروحة</option><option value="read" data-v-a0683062>قراءة</option><option value="readAndWrite" data-v-a0683062>كتابة أطروحة</option><option value="screenshots" data-v-a0683062>اقتباسات</option><option value="screenshotsAndWrite" data-v-a0683062>كتابة واقتباسات</option>',5),m=[c],p={key:0,class:"row mt-2"},g={class:"form-group"},u={key:1,class:"row"},v=h((()=>(0,i._)("span",{class:"material-symbols-outlined md-18"}," refresh ",-1))),y={class:"form-group col-6"},k=h((()=>(0,i._)("option",{value:""},"صفحة البداية",-1))),b=["value"],_={key:0,class:"help-block"},f={key:0,style:{color:"red"}},w={key:1,style:{color:"red"}},T={class:"form-group col-6"},F=h((()=>(0,i._)("option",{value:""},"صفحة النهاية",-1))),$=["value"],O={key:0,class:"help-block"},q={key:0,style:{color:"red"}},D={key:1,style:{color:"red"}},S={key:2,class:"form-group"},E=h((()=>(0,i._)("label",{class:"form-label",for:"thesisBody"},"الأطروحة",-1))),M={style:{direction:"rtl"}},x=h((()=>(0,i._)("span",null," - ",-1))),A={key:0,style:{color:"red"},class:"text-center"},I=h((()=>(0,i._)("span",{class:"material-symbols-outlined font-small"},"error",-1))),C={key:1,style:{color:"green"}},P=h((()=>(0,i._)("span",{class:"material-symbols-outlined font-small"},"check_circle",-1))),B={key:0,class:"help-block"},H={key:0,style:{color:"red"}},W={key:3,class:"form-group"},Z=h((()=>(0,i._)("label",{class:"form-label",for:"customFile"}," اضافة اقتباس",-1))),j={key:0,class:"help-block"},U={key:0,style:{color:"red"}},z=h((()=>(0,i._)("hr",null,null,-1))),N={key:4,class:"text-danger text-center"},V={key:5,class:"text-danger text-center"},Y={key:6,class:"col-sm-12 text-center"},K=["src"],R=["disabled"];function G(e,s,h,c,G,J){const L=(0,i.up)("ImagePreviewer");return(0,i.wg)(),(0,i.iD)("form",{onSubmit:s[7]||(s[7]=(0,o.iM)(((...e)=>J.submit&&J.submit(...e)),["prevent"]))},[(0,i._)("div",a,[(0,i._)("div",l,[d,(0,i._)("div",n,[(0,i.wy)((0,i._)("select",{class:"form-select w-100",name:"type_of_thesis",id:"type_of_thesis","onUpdate:modelValue":s[0]||(s[0]=e=>c.v$.thesisForm.typeOfThesis.$model=e),onChange:s[1]||(s[1]=e=>J.changeTypeOfThesis(e.target.options[e.target.options.selectedIndex].value))},m,544),[[o.bM,c.v$.thesisForm.typeOfThesis.$model]])])]),G.showPages?((0,i.wg)(),(0,i.iD)("div",p,[(0,i._)("div",g,[(0,i._)("h5",{class:(0,r.C_)(["form-label",{"text-primary":0===J.pages.length&&!G.startOver}])},(0,r.zw)(0!==J.pages.length||G.startOver?"الصفحات":"لقد أنهيت الكتاب"),3)])])):(0,i.kq)("",!0),G.showPages?((0,i.wg)(),(0,i.iD)("div",u,[0!==J.pages.length||G.startOver?((0,i.wg)(),(0,i.iD)(i.HY,{key:1},[(0,i._)("div",y,[(0,i.wy)((0,i._)("select",{class:"form-select","data-trigger":"",name:"start_page",id:"start_page","onUpdate:modelValue":s[3]||(s[3]=e=>c.v$.thesisForm.start_page.$model=e)},[k,((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(J.pages,(e=>((0,i.wg)(),(0,i.iD)("option",{value:e,key:e},(0,r.zw)(e),9,b)))),128))],512),[[o.bM,c.v$.thesisForm.start_page.$model]]),c.v$.thesisForm.start_page.$error?((0,i.wg)(),(0,i.iD)("div",_,[c.v$.thesisForm.start_page.required.$invalid?((0,i.wg)(),(0,i.iD)("small",f,"الرجاء اختيار صفحة البداية")):(0,i.kq)("",!0),!c.v$.thesisForm.start_page.required.$invalid&&c.v$.thesisForm.start_page.between.$invalid?((0,i.wg)(),(0,i.iD)("small",w,"البداية يجب ان تكون اقل من النهاية")):(0,i.kq)("",!0)])):(0,i.kq)("",!0)]),(0,i._)("div",T,[(0,i.wy)((0,i._)("select",{class:"form-select","data-trigger":"",name:"end_page",id:"end_page","onUpdate:modelValue":s[4]||(s[4]=e=>c.v$.thesisForm.end_page.$model=e)},[F,((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(J.pages,(e=>((0,i.wg)(),(0,i.iD)("option",{value:e,key:e},(0,r.zw)(e),9,$)))),128))],512),[[o.bM,c.v$.thesisForm.end_page.$model]]),c.v$.thesisForm.end_page.$error?((0,i.wg)(),(0,i.iD)("div",O,[c.v$.thesisForm.end_page.required.$invalid?((0,i.wg)(),(0,i.iD)("small",q,"الرجاء اختيار صفحة النهاية")):(0,i.kq)("",!0),!c.v$.thesisForm.end_page.required.$invalid&&c.v$.thesisForm.end_page.between.$invalid?((0,i.wg)(),(0,i.iD)("small",D,"النهاية يجب ان تكون اكبر من البداية")):(0,i.kq)("",!0)])):(0,i.kq)("",!0)])],64)):((0,i.wg)(),(0,i.iD)("button",{key:0,class:"btn btn-primary me-2 d-flex align-content-center justify-content-center",onClick:s[2]||(s[2]=(0,o.iM)(((...e)=>J.startBookOver&&J.startBookOver(...e)),["prevent"]))},[v,(0,i.Uk)(" إعادة قراءة الكتاب ")]))])):(0,i.kq)("",!0),G.thesis?((0,i.wg)(),(0,i.iD)("div",S,[E,(0,i.wy)((0,i._)("textarea",{rows:"5",placeholder:"... اكتب أطروحتك",class:"rounded form-control",id:"thesisBody",name:"thesisBody","onUpdate:modelValue":s[5]||(s[5]=e=>c.v$.thesisForm.body.$model=e)},null,512),[[o.nr,c.v$.thesisForm.body.$model,void 0,{trim:!0}]]),(0,i._)("p",M,[(0,i._)("span",null,(0,r.zw)(c.v$.thesisForm.body.$model.length)+"/400 حرف",1),x,c.v$.thesisForm.body.$model.length<400?((0,i.wg)(),(0,i.iD)("span",A,[(0,i.Uk)("أطروحة غير شاملة "),I])):((0,i.wg)(),(0,i.iD)("span",C,[(0,i.Uk)("أطروحة شاملة "),P]))]),c.v$.thesisForm.body.$error?((0,i.wg)(),(0,i.iD)("div",B,[c.v$.thesisForm.body.requiredIf.$invalid?((0,i.wg)(),(0,i.iD)("small",H,"الرجاء ادخال الأطروحة")):(0,i.kq)("",!0)])):(0,i.kq)("",!0)])):(0,i.kq)("",!0),G.screenshots?((0,i.wg)(),(0,i.iD)("div",W,[Z,(0,i._)("input",{class:"form-control",type:"file",id:"customFile",multiple:"",accept:"image/jpeg, image/png, image/jpg, image/gif, image/svg",ref:"screenShots",onChange:s[6]||(s[6]=(...e)=>J.previewImages&&J.previewImages(...e))},null,544),c.v$.thesisForm.screenShots.$error?((0,i.wg)(),(0,i.iD)("div",j,[c.v$.thesisForm.screenShots.requiredIf.$invalid?((0,i.wg)(),(0,i.iD)("small",U,"الرجاء ادخال اقتباس واحد على الاقل")):(0,i.kq)("",!0)])):(0,i.kq)("",!0),G.thesisForm.screenShots.length?((0,i.wg)(),(0,i.j4)(L,{key:1,media:G.thesisForm.screenShots,onRemoveMedia:J.removeImage,ref:"imagePreviewer"},null,8,["media","onRemoveMedia"])):(0,i.kq)("",!0)])):(0,i.kq)("",!0),z,G.errorMessage?((0,i.wg)(),(0,i.iD)("small",N,(0,r.zw)(G.errorMessage),1)):(0,i.kq)("",!0),G.mediaNoteText&&h.thesisToEdit?((0,i.wg)(),(0,i.iD)("small",V,(0,r.zw)(G.mediaNoteText),1)):(0,i.kq)("",!0),G.loader?((0,i.wg)(),(0,i.iD)("div",Y,[(0,i._)("img",{src:t(79885),alt:"loader",style:{height:"100px"}},null,8,K)])):(0,i.kq)("",!0),G.loader?(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)("button",{key:7,type:"submit",class:"btn btn-primary d-block mt-3",disabled:c.v$.thesisForm.$invalid}," إضافة ",8,R))])],32)}var J=t(54028),L=t(62587),Q=t(27522),X=t(91130),ee=t(8209),se={name:"CreateThesis",components:{ImagePreviewer:X.Z},props:{book:{type:Object,default:null},lastThesis:{type:Object,default:null},thesisToEdit:{type:Object,default:null}},setup(){return{v$:(0,J.ZP)()}},data(){return{thesis:!1,screenshots:!1,showPages:!1,loader:!1,startOver:!1,thesisForm:{typeOfThesis:"",start_page:"",end_page:"",body:"",screenShots:[],type:"thesis",book_id:null,u_comment_id:null},mediaNoteText:"",errorMessage:""}},computed:{pages(){let e=[],s=null;if(this.book.userBooks.length&&"in progress"===this.book.userBooks[0].status?s=this.lastThesis?this.lastThesis?.end_page+1:this.book.start_page:this.book.userBooks.length||this.lastThesis||(s=this.book.start_page),this.thesisToEdit&&(s=this.book.start_page),null===s&&!this.startOver)return[];null===s&&this.startOver&&(s=this.book.start_page);for(let t=s;t<=this.book.end_page;t++)e.push(t);return e},successMessage(){return this.thesisToEdit?"تم تعديل الأطروحة بنجاح":"تم إضافة الأطروحة بنجاح"}},watch:{book(){this.thesisForm.book_id=this.book.id}},created(){if(this.thesisToEdit){this.thesisForm.u_comment_id=parseInt(this.thesisToEdit.id),this.thesisForm.body=this.thesisToEdit.body?this.thesisToEdit.body:"",this.thesisForm.start_page=this.thesisToEdit.thesis.start_page,this.thesisForm.end_page=this.thesisToEdit.thesis.end_page,this.thesisForm.screenShots.old=this.thesisToEdit.media??[],this.showPages=!0,!this.thesisToEdit.body&&0===this.checkThesisHasMedia(this.thesisToEdit)||!this.thesisToEdit.body&&this.checkThesisHasMedia(this.thesisToEdit)>0?this.thesisForm.typeOfThesis="read":(this.thesisToEdit.body&&0===this.checkThesisHasMedia(this.thesisToEdit)||this.thesisToEdit.body&&this.checkThesisHasMedia(this.thesisToEdit)>0)&&(this.thesisForm.typeOfThesis="readAndWrite"),this.changeTypeOfThesis(this.thesisForm.typeOfThesis);const e=this.checkThesisHasMedia(this.thesisToEdit);this.mediaNoteText=e>0?`ملاحظة: سيتم حذف الصور الموجودين بعد تعديل الأطروحة وعددهم: ${e}`:""}else this.thesisForm.book_id=this.book?.id},methods:{showAddThesis(){this.thesis=!0,this.screenshots=!1},showAddScreenshots(){this.screenshots=!0,this.thesis=!1},noThesisAndScreenshots(){this.thesis=!1,this.screenshots=!1},thesisAndScreenshots(){this.thesis=!0,this.screenshots=!0},changeTypeOfThesis(e){this.showPages=!0,"read"==e?this.noThesisAndScreenshots():"readAndWrite"==e?this.showAddThesis():"screenshots"==e?this.showAddScreenshots():"screenshotsAndWrite"==e?this.thesisAndScreenshots():(this.showPages=!1,this.noThesisAndScreenshots())},previewImages(e){this.thesisForm.screenShots=e.target.files},removeImage(e){const s=[...this.thesisForm.screenShots];s.splice(e,1),this.thesisForm.screenShots=s,0==this.thesisForm.screenShots.length&&(this.$refs.screenShots.value=null)},async submit(){if(this.v$.$touch(),this.v$.thesisForm.$invalid)this.errorMessage="الرجاء ادخال جميع البيانات المطلوبة";else{this.loader=!0;try{let e;if(this.updateThesisForm(),e=this.thesisToEdit?await Q.Z.update(this.thesisForm):await Q.Z.create(this.thesisForm),200!==e.statusCode)throw e.data;ee.Z.handleSuccessSwal(this.successMessage),this.thesisToEdit?setTimeout((()=>{location.reload()}),1800):(this.$emit("addThesis",e.data),this.thesisForm={...this.thesisForm,typeOfThesis:"",start_page:"",end_page:"",body:"",screenShots:[]},this.v$.thesisForm.$reset(),this.changeTypeOfThesis(""),setTimeout((()=>{this.$emit("closeModel")}),2e3))}catch(e){ee.Z.handleErrorSwal("حدث خطأ ما, يرجى المحاولة مرة أخرى!"),console.log(e)}finally{this.loader=!1}}},updateThesisForm(){"read"==this.thesisForm.typeOfThesis?(this.thesisForm.body=null,this.thesisForm.screenShots=[]):"readAndWrite"==this.thesisForm.typeOfThesis?this.thesisForm.screenShots=[]:"screenshots"==this.thesisForm.typeOfThesis&&(this.thesisForm.body=null)},startBookOver(){this.startOver=!0},checkThesisHasMedia(e){let s=0;return e.media&&s++,e.replies?.length&&e.replies.forEach((e=>{"screenshot"===e.type&&e.media&&s++})),s}},validations(){return{thesisForm:{typeOfThesis:{required:L.C1},start_page:{required:L.C1,between:e=>parseInt(e)<parseInt(this.thesisForm.end_page)},end_page:{required:L.C1,between:e=>parseInt(e)>parseInt(this.thesisForm.start_page)},body:{requiredIf:(0,L.CF)((()=>"readAndWrite"==this.thesisForm.typeOfThesis||"screenshotsAndWrite"==this.thesisForm.typeOfThesis))},screenShots:{requiredIf:(0,L.CF)((()=>"screenshots"==this.thesisForm.typeOfThesis||"screenshotsAndWrite"==this.thesisForm.typeOfThesis))}}}}},te=t(83744);const ie=(0,te.Z)(se,[["render",G],["__scopeId","data-v-a0683062"]]);var oe=ie},21218:function(e,s,t){e.exports=t.p+"img/200x200-book.5a0360f9.png"}}]);
//# sourceMappingURL=9002.40e20238.js.map